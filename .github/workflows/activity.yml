name: Activity Log Update

on:
  schedule:
    - cron: '0 12 * * *'  # Runs daily at 12:00 UTC
  workflow_dispatch:

jobs:
  commit-job:
    runs-on: ubuntu-latest
    steps:
      - name: Decide whether to run today
        id: decision
        run: |
          DECISION_ARRAY=(1 1 1 1 1 1 1 0 0 0) 
          RANDOM_PICK=${DECISION_ARRAY[$RANDOM % ${#DECISION_ARRAY[@]}]}
          
          if [[ $RANDOM_PICK -eq 0 ]]; then
            echo "Skipping today's run."
            echo "CONTINUE_RUN=false" >> $GITHUB_ENV
          else
            echo "Running update."
            echo "CONTINUE_RUN=true" >> $GITHUB_ENV
          fi

      - name: Select repository
        if: env.CONTINUE_RUN == 'true'
        run: |
          REPOS=("Fanpit-Backend" "PennyWise" "Skincare-Analysis-Frontend" "Trainify-A-Virtual-AI-Trainer" "sense-guard-monitor" "Underwater-Plastic-Detection")
          SELECTED_REPO=${REPOS[$RANDOM % ${#REPOS[@]}]}
          echo "SELECTED_REPO=$SELECTED_REPO" >> $GITHUB_ENV

      - name: Clone and Config
        if: env.CONTINUE_RUN == 'true'
        run: |
          git clone https://github.com/Abishek0411/${{ env.SELECTED_REPO }}.git
          cd ${{ env.SELECTED_REPO }}
          # Use GitHub's bot email to keep your personal email private (optional)
          git config --global user.name "Abishek0411"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Commit and Push
        if: env.CONTINUE_RUN == 'true'
        run: |
          cd ${{ env.SELECTED_REPO }}
          
          # 1. Determine random number of commits
          NUM_COMMITS=$(( RANDOM % 5 + 1 ))
          
          # 2. Loop and commit
          for i in $(seq 1 $NUM_COMMITS); do
            echo "$(date) - Activity Log Update $i" >> activity.log
            git add -f activity.log
            git commit -m "activity update $i on $(date)"
          done
          
          # 3. Detect the current branch (Main or Master) automatically
          CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
          
          # 4. Push to that specific branch
          git push https://Abishek0411:${{ secrets.GH_PAT }}@github.com/Abishek0411/${{ env.SELECTED_REPO }}.git $CURRENT_BRANCH